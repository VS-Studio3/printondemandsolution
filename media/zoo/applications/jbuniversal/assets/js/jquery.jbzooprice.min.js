/**
 * JBZoo is universal CCK based Joomla! CMS and YooTheme Zoo component
 * @category   JBZoo
 * @author     smet.denis <admin@joomla-book.ru>
 * @copyright  Copyright (c) 2009-2012, Joomla-book.ru
 * @license    http://joomla-book.ru/info/disclaimer
 * @link       http://joomla-book.ru/projects/jbzoo JBZoo project page
 */

(function ($) {
    $.ajaxSetup({
        headers:{ "cache-control":"no-cache" }
    });

    $.fn.JBZooPrice = function (options) {

        var $this = $(this);

        return $this.each(function (n, obj) {

            var $obj = $(obj);

            $(".jsPriceCurrency", $obj).click(function () {
                var $cur = $(this),
                    currency = $cur.attr("currency");

                $(".jsPriceValue", $obj).removeClass("active");
                $(".price-currency-" + currency, $obj).addClass("active");

                $(".jsPriceCurrency", $obj).removeClass("active");
                $cur.addClass("active");
            });

            $(".jsAddToCart", $obj).click(function () {
                var $link = $(this);
                $.fancybox({
                    'type':'iframe',
                    'href':$link.attr('href'),
                    'width':360,
                    'fitToView':false
                });

                return false;
            });


            $(".jsRemoveFromCart", $obj).click(function () {
                var $link = $(this);
                $.post($link.attr("href"), {}, function (data) {
                    $obj.removeClass('in-cart').addClass('not-in-cart');
                    $.fn.JBZooPriceReloadBasket();
                }, "json");
                return false;
            });
        });
    };

    $.fn.JBZooPriceToggle = function (elementId, itemId) {
        var $priceObj = $('.jsPrice-' + elementId + '-' + itemId);
        $priceObj.removeClass('not-in-cart').addClass('in-cart');
        $.fn.JBZooPriceReloadBasket();
    };

    $.fn.JBZooPriceReloadBasket = function () {

        $('.jsJBZooModuleBasket').each(function (n, obj) {

            var $obj = $(obj);

            $.get('index.php', {
                    'app_id':$obj.attr('appId'),
                    'moduleId':$obj.attr('moduleId'),
                    'option':'com_zoo',
                    'controller':'basket',
                    'task':'reloadModule'
                },
                function (data) {
                    $obj.replaceWith($(data).find('.jsJBZooModuleBasket'));
                },
                'html'
            );

        });
    };

})(jQuery);
